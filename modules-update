#!/bin/sh

PROGRAM=$(basename $0)
HEADER="### This file is generated by modules-update"
CONF="$ROOT/etc/modprobe.conf"

usage() {
	echo "Usage: $PROGRAM [-fh]

Options:
 -f	Force regeneration of modprobe.conf
 -h	Show this help

"
	exit 1
}

update_modules() {
	echo "$HEADER" > "$CONF"
	cat $ROOT/etc/modules.d/* $ROOT/etc/modprobe.d/* 2>/dev/null >> "$CONF"
}
		

while getopts "fh" opt ; do
	case $opt in
		f) FORCE="-f";;
		h) usage;;
	esac
done

shift $(( $OPTIND - 1 ))
[ $# -gt 0 ] && usage

if [ "`head -n 1 $ROOT/etc/modprobe.conf`" != "$HEADER" ] ; then
	if [ "$FORCE" ]; then
		update_modules
	else
		echo "Warning: current $CONF has not been automatically generated"
		echo "Use \"$PROGRAM -f\" to force regeneration"
	fi
else
	update_modules
fi

